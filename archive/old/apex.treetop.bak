grammar Apex
  rule string
    "'" (!"'" . / "\\'")* "'" <StringLiteral>
  end

  rule integer
    ('+' / '-')? [0-9]+ <IntegerLiteral>
  end

  rule space
    [\s]+
  end

  rule literal_value
    ( string / integer )
  end

  rule keyword
    identifier &{|seq| Keyword.include? seq[0].text_value } <Keyword>
  end

  rule identifier
    [\w]+ !(!' ' .)
  end

  rule new_variable
    identifier !{|seq|
		b = Variable.include? seq[0].text_value
		Variable.add seq[0].text_value unless b
		b } <Variable>
  end

  rule old_variable
    identifier &{|seq| Variable.include? seq[0].text_value } <Variable>
  end

  rule declaration
    keyword space+ new_variable ( space* '=' )* <Declaration>
  end

  rule value
    ( literal_value / old_variable )
  end

  rule assignment
    space* ( declaration / old_variable ) space* '=' space* value space* ';' <Assignment>
  end
end
